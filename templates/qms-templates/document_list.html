{% include "qms-templates/header.html" %}

<style>
  html, body{ height:100%; margin:0; }
  body{ display:flex; flex-direction:column; }
  .main-content{ flex:1; }

  :root{
    --container:1200px;
    --r:18px;
    --line: rgba(11,18,32,.10);
    --shadow: 0 14px 30px rgba(0,0,0,.08);
    --muted: rgba(11,18,32,.62);
    --ok:#1F9D55;
    --warn:#F5A524;
    --bad:#E11D48;
    --em-blue:#006EB3;
  }

  .page{
        width:100%;
        max-width:100%;
        margin:0;
        padding:20px 40px;   /* ØªØ­ÙƒÙ… Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø· */
    }

  .topbar{
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    margin: 16px 0;
  }

  .title{ margin:0; font-size:22px; font-weight:900; }
  .sub{ margin:6px 0 0; color:var(--muted); font-size:13.5px; }

 .filters{
  display:flex;
  gap:12px;
  align-items:center;      /* Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ù…ÙˆØ¯ÙŠØ© */
  margin-top:2px;          /* ğŸ‘ˆ ÙŠØ±ÙØ¹Ù‡Ù… Ù‚Ù„ÙŠÙ„Ù‹Ø§ */
}

.search,
.filters select,
.chip{
  margin:0;
}

.search{ 
  position:relative; 
  width:320px; 
  max-width:85vw; 
}

.search input{
  width:100%;
  height:42px;
  padding:0 14px 0 40px;
  border-radius:999px;
  border:1px solid var(--line);
  font-size:13.5px;
  box-sizing:border-box;
  line-height:42px;        /* ğŸ‘ˆ ÙŠØ«Ø¨Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ */
}

.filters select{
  height:42px;
  padding:0 36px 0 14px;
  border-radius:999px;
  border:1px solid var(--line);
  font-size:13.5px;
  font-weight:400;
  box-sizing:border-box;
  line-height:42px;        /* ğŸ‘ˆ Ù†ÙØ³ search */
  appearance:none;
  background:#fff;
  background-image:url("data:image/svg+xml;utf8,<svg fill='%230B1220' height='16' viewBox='0 0 20 20' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M5 7l5 5 5-5'/></svg>");
  background-repeat:no-repeat;
  background-position:right 12px center;
  background-size:14px;
}

  .chip{
    height:42px;
    display:flex;
    align-items:center;
    padding:0 14px;
    border-radius:999px;
    border:1px solid var(--line);
  }
  .grid{
    display:grid;
    grid-template-columns: repeat(5, 1fr);
    gap:14px;
  }

  .card{
  position:relative; /* Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† Ø§Ù„Ø¨Ø§Ø¯Ø¬ */
  background:#fff;
  border:1px solid var(--line);
  border-radius: var(--r);
  box-shadow: var(--shadow);
  padding:18px 18px 20px 18px;
  transition:.18s ease;
  overflow:hidden;
}

.card:hover{
  transform:translateY(-3px);
  box-shadow:0 18px 36px rgba(0,0,0,.10);
}

/* Disabled Styling Ø£Ù‚ÙˆÙ‰ */
.card.disabled-card{
  opacity:.88;
  border-color: rgba(245,165,36,.35);
  background: linear-gradient(
      180deg,
      rgba(245,165,36,.04),
      #fff 60%
  );
}


/* Ø¹Ù†ÙˆØ§Ù† */
.doc-title{
  margin:0;
  font-size:16px;
  font-weight:900;
  line-height:1.3;
  padding-right:90px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø¨Ø§Ø¯Ø¬ */
}

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
.meta{
  margin:8px 0 0;
  color: var(--muted);
  font-size:13px;
}

/* Badge Ø£Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† */
.badge{
  position:absolute;
  top:14px;
  right:14px;

  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  letter-spacing:.3px;

  border:1px solid var(--line);
}

/* Ø­Ø§Ù„Ø§Øª */
.badge.active{
  background:rgba(31,157,85,.12);
  border-color:rgba(31,157,85,.25);
  color:#1F9D55;
}

.badge.disabled{
  background:rgba(245,165,36,.15);
  border-color:rgba(245,165,36,.35);
  color:#F5A524;
}

.badge.archived{
  background:rgba(225,29,72,.12);
  border-color:rgba(225,29,72,.25);
  color:#E11D48;
}
  .active{ background: rgba(31,157,85,.12); color: var(--ok); }
  .disabled{ background: rgba(245,165,36,.15); color: var(--warn); }
  .archived{ background: rgba(225,29,72,.12); color: var(--bad); }

  .actions{
    margin-top:12px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    text-decoration:none;
    font-weight:900;
    font-size:12.8px;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid var(--line);
    background:#fff;
    transition:.15s ease;
  }

  .btn.primary{
    background: rgba(0,110,179,.10);
    border-color: rgba(0,110,179,.18);
    color: var(--em-blue);
  }

  .btn.locked{
    background: rgba(245,165,36,.15);
    border-color: rgba(245,165,36,.25);
    color: var(--warn);
    cursor:pointer;
  }

  .btn.danger{
    background: rgba(225,29,72,.08);
    border-color: rgba(225,29,72,.18);
    color: var(--bad);
  }

  .empty{
    background:#fff;
    border:1px solid var(--line);
    border-radius: var(--r);
    padding:18px;
    color: var(--muted);
    text-align:center;
  }

  /* Modal */
  .modal-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.45);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:9999;
  }

  .modal{
    background:#fff;
    padding:30px;
    border-radius:20px;
    width:400px;
    max-width:90%;
    text-align:center;
    box-shadow:0 25px 50px rgba(0,0,0,.2);
  }

  .modal i{
    font-size:38px;
    color: var(--warn);
  }

  .modal h3{
    margin:15px 0 8px;
    font-size:18px;
    font-weight:900;
  }

  .modal p{
    color:var(--muted);
    font-size:14px;
  }

  .modal button{
    margin-top:18px;
    padding:10px 18px;
    border:none;
    border-radius:10px;
    background: var(--em-blue);
    color:#fff;
    font-weight:800;
    cursor:pointer;
  }

  @media (max-width: 980px){
    .grid{ grid-template-columns: 1fr; }
  }
  .filters select{
  height:42px;
  padding:0 36px 0 14px;
  border-radius:999px;
  border:1px solid var(--line);
  background:#fff;
  font-size:13.5px;
  font-weight:400;           /* ğŸ‘ˆ Ø¹Ø§Ø¯ÙŠ ÙˆÙ„ÙŠØ³ Ø¨ÙˆÙ„Ø¯ */
  color:#0B1220;
  appearance:none;           /* ğŸ‘ˆ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
  -webkit-appearance:none;
  -moz-appearance:none;
  cursor:pointer;
  transition:.2s ease;
  background-image:url("data:image/svg+xml;utf8,<svg fill='%230B1220' height='16' viewBox='0 0 20 20' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M5 7l5 5 5-5'/></svg>");
  background-repeat:no-repeat;
  background-position:right 12px center;
  background-size:14px;
}

.filters select:hover{
  border-color: var(--em-blue);
}
</style>

<div class="main-content">
  <div class="page">

    <div class="topbar">
      <div>
        <h1 class="title">
        {% if context_department %}
            {{ context_department }} Documents
        {% else %}
            All Documents
        {% endif %}
           </h1>
        <p class="sub">Showing documents based on your access level.</p>
      </div>

     <div class="filters">

        <!-- ğŸ” Search -->
        <div class="search">
          <span class="icon"><i class="bi bi-search"></i></span>
          <input id="docSearch" type="search" placeholder="Search by title..." />
        </div>

        <!-- ğŸ¢ Department Filter (Admin / Quality Only) -->
        {% if can_manage %}
        <form method="get">
          <select name="department"
                  onchange="this.form.submit()"
                  class="chip">
            <option value="">All Departments</option>

            {% for dept in departments %}
              <option value="{{ dept.id }}"
                {% if request.GET.department == dept.id|stringformat:"s" %}
                    selected
                {% endif %}
              >
                {{ dept.name }}
              </option>
            {% endfor %}
          </select>
        </form>
        {% endif %}

        <!-- ğŸ“Š Total Counter -->
        <div class="chip">
          <i class="bi bi-files"></i> Total: {{ total_docs }}
        </div>

      </div>
    </div>

    {% if documents %}
      <div class="grid" id="docGrid">
        {% for doc in documents %}
          <div class="card doc-item {% if doc.status == 'disabled' %}disabled-card{% endif %}" 
               data-title="{{ doc.title|lower }}">
            <h3 class="doc-title">{{ doc.title }}</h3>

            <div class="meta">
              <div><b>Department:</b> {{ doc.department.name }}</div>
              <div><b>Updated:</b> {{ doc.updated_at|date:"Y-m-d" }}</div>
            </div>

            <span class="badge {{ doc.status }}">{{ doc.get_status_display }}</span>

            <div class="actions">

              <a class="btn {% if doc.status == 'disabled' %}locked{% else %}primary{% endif %}"
              href="{% url 'documents:view' doc.id %}">
              <i class="bi {% if doc.status == 'disabled' %}bi-lock-fill{% else %}bi-eye{% endif %}"></i>
              {% if doc.status == 'disabled' %}Open{% else %}View PDF{% endif %}
              </a>

              {% if can_manage %}
                <a class="btn" href="{% url 'documents:edit' doc.id %}">
                  <i class="bi bi-pencil"></i> Edit
                </a>

                <a class="btn danger"
                   href="{% url 'documents:delete' doc.id %}"
                   onclick="return confirm('Are you sure you want to delete this document?');">
                  <i class="bi bi-trash"></i> Delete
                </a>
              {% endif %}

            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty">No documents available.</div>
    {% endif %}

  </div>
</div>

{% include "qms-templates/footer.html" %}

<script>
  
  (function(){
    const input = document.getElementById("docSearch");
    const items = document.querySelectorAll(".doc-item");
    if(!input || !items.length) return;

    input.addEventListener("input", function(){
      const q = (input.value || "").toLowerCase().trim();
      items.forEach(el=>{
        const t = el.getAttribute("data-title") || "";
        el.style.display = t.includes(q) ? "" : "none";
      });
    });
  })();
</script>